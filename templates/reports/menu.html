{% extends "base.html" %}
  {% block container %}
<nav class="navbar navbar-default" role="navigation" ng-controller="NavbarController as vm">
  <div class="container-fluid">
    <div class="navbar-header">
      <a class="navbar-brand" href="/">ФК Красота и Сила</a>
    </div> <!-- ./navbar-header -->
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav pull-right">
        {% if request.user.is_authenticated %}
          <li>{{ request.user.username }}</li>
          <li><a href="javascript:void(0)" ng-click="vm.logout()">Выход</a></li>
        {% else %}
          <li><a href="#/login">Вход</a></li>
        {% endif %}
      </ul>
    </div> <!-- /.collapse.navbar-collapse -->
  </div> <!-- /.container-fluid -->
</nav>

  <div class="container-fluid">
      <label class="col-md-1 control-label">С:</label>
      <div class="col-md-2">
        <input name="fdate" type="text"  class="form-control date"
        value="{% now 'd.m.Y' %}">
      </div>
      <label class="col-md-1 control-label">По:</label>
      <div class="col-md-2">
        <input name="tdate" type="text"  class="form-control date"
        value="{% now 'd.m.Y' %}">
      </div>
    </div>
   <br>
   <br>
  <div class="col-lg-3">
    <a id='r_sells' href="/api/v1/reports/sales/?fdate={% now 'd.m.Y' %}" class="btn btn-info btn-block">
      продажи за день</a>
  </div>
  <div class="col-lg-3">
    <a id='r_visits'
    href="/api/v1/reports/visits/?fdate={% now 'd.m.Y' %}"
    class="btn btn-warning btn-block">
      посещения</a>
  </div>
  <div class="col-lg-3">
    <a id='r_birthdays'
    href="/api/v1/reports/birthdays/?fdate={% now 'd.m.Y' %}&tdate={% now 'd.m.Y' %}"
    class="btn btn-success btn-block">
      Дни рождения</a>
  </div>
  <div class="col-lg-3">&nbsp;</div>
  <div class="clo-md-12">&nbsp;</div>
  <br/>
  <div class="col-md-3">
    <a id='r_active_card' href="/api/v1/reports/acc/?cc=0"
    class="btn btn-success btn-block">Активные клубные карты</a>
  </div>
  <div class="col-md-3">
  <select name="club_card_type" class="btn-block">
    <option value="0">-------</option>
    {% for option in cc_options %}
    <option value="{{ option.club_card__pk }}">
      {{ option.club_card__name }}
    </option>
    {% endfor %}
  </select>
  </div>
    <div class="col-md-3">
    <a id='r_active_card' href="/api/v1/reports/ccc/"
    class="btn btn-danger btn-block">Кредиты по клубным картам</a>
  </div>
  <div class="col-lg-3">
    <a id='r_new_uid'
    href="/api/v1/reports/new_uid/?fdate={% now 'd.m.Y' %}&tdate={% now 'd.m.Y' %}"
    class="btn btn-warning btn-block">
      Новые ЧС</a>
  </div>
  <div class="clo-md-12">&nbsp;</div>
  <br/>
  <div class="col-lg-3">
    <a id='r_cl'
    href="/api/v1/reports/cl/?fdate={% now 'd.m.Y' %}&tdate={% now 'd.m.Y' %}"
    class="btn btn-primary btn-block">
      Общий список клиентов</a>
  </div>
  <div class="col-lg-3">
    <a id='r_fcc'
    href="/api/v1/reports/fcc/?fdate={% now 'd.m.Y' %}&tdate={% now 'd.m.Y' %}"
    class="btn btn-info btn-block">
      тестирование (со скидкой 50%)</a>
  </div>
  <div class="col-lg-3">
    <a id='r_fl'
    href="/api/v1/reports/fl/"
    class="btn btn-success btn-block">
      Полный список клиентов</a>
  </div>  

{% endblock %}

  {% block extra_js %}
<script type="text/javascript">

var updateUrlParam = function updateUrlParam(get_string, param, value) {
  var sURLVariables = get_string.substring(1).split('&')
  for (i = 0; i < sURLVariables.length; i++) {
    var sParameterName = sURLVariables[i].split('=');
    if (sParameterName[0] === param) {
      sURLVariables[i] = sParameterName[0] + '=' + value
      return '?' + sURLVariables.join('&')
    }
  }
}

  jQuery(function($){
   $(".date").mask("99.99.9999");

  $('[name=fdate]').change(function() {
    var fdate = $(this).val()
    // r_sells
    var r_sells = $('#r_sells').attr('href').split('/')
    var get_str = updateUrlParam(r_sells[5], 'fdate', fdate)
    var r_sells_url = r_sells.slice(0, 5).join('/') + '/' + get_str
    $('#r_sells').attr('href', r_sells_url)
    // r_visits
    var r_visits = $('#r_visits').attr('href').split('/')
    var get_str = updateUrlParam(r_visits[5], 'fdate', fdate)
    var r_visits_url = r_visits.slice(0, 5).join('/') + '/' + get_str
    $('#r_visits').attr('href', r_visits_url)
    // r_birthdays
    var r_birthdays = $('#r_birthdays').attr('href').split('/')
    var get_str = updateUrlParam(r_birthdays[5], 'fdate', fdate)
    var r_birthdays_url = r_birthdays.slice(0, 5).join('/') + '/' + get_str
    $('#r_birthdays').attr('href', r_birthdays_url)
    // r_new_uid
    var r_new_uid = $('#r_new_uid').attr('href').split('/')
    var get_str = updateUrlParam(r_new_uid[5], 'fdate', fdate)
    var r_new_uid_url = r_new_uid.slice(0, 5).join('/') + '/' + get_str
    $('#r_new_uid').attr('href', r_new_uid_url)
    // r_cl
    var r_cl = $('#r_cl').attr('href').split('/')
    var get_str = updateUrlParam(r_cl[5], 'fdate', fdate)
    var r_cl_url = r_cl.slice(0, 5).join('/') + '/' + get_str
    $('#r_cl').attr('href', r_cl_url)
    // r_fcc
    var r_fcc = $('#r_fcc').attr('href').split('/')
    var get_str = updateUrlParam(r_fcc[5], 'fdate', fdate)
    var r_cl_url = r_fcc.slice(0, 5).join('/') + '/' + get_str
    $('#r_fcc').attr('href', r_cl_url)
  });

  $('[name=tdate]').change(function() {
    var tdate = $(this).val()
    // r_birthdays
    var r_birthdays = $('#r_birthdays').attr('href').split('/')
    var get_str = updateUrlParam(r_birthdays[5], 'tdate', tdate)
    var r_birthdays_url = r_birthdays.slice(0, 5).join('/') + '/' + get_str
    $('#r_birthdays').attr('href', r_birthdays_url)
    // r_new_uid
    var r_new_uid = $('#r_new_uid').attr('href').split('/')
    var get_str = updateUrlParam(r_new_uid[5], 'tdate', tdate)
    var r_new_uid_url = r_new_uid.slice(0, 5).join('/') + '/' + get_str
    $('#r_new_uid').attr('href', r_new_uid_url)
    // r_cl
    var r_cl = $('#r_cl').attr('href').split('/')
    var get_str = updateUrlParam(r_cl[5], 'tdate', tdate)
    var r_cl_url = r_cl.slice(0, 5).join('/') + '/' + get_str
    $('#r_cl').attr('href', r_cl_url)
    // r_fcc
    var r_fcc = $('#r_fcc').attr('href').split('/')
    var get_str = updateUrlParam(r_fcc[5], 'tdate', tdate)
    var r_fcc_url = r_fcc.slice(0, 5).join('/') + '/' + get_str
    $('#r_fcc').attr('href', r_cl_url)
  });

  $('[name=club_card_type]').change(function() {
    var club_card_type = $(this).val()
    var r_active_card = $('#r_active_card').attr('href').split('/')
    var get_str = updateUrlParam(r_active_card[5], 'cc', club_card_type)
    var r_active_card_url = r_active_card.slice(0, 5).join('/') + '/' + get_str
    $('#r_active_card').attr('href', r_active_card_url)
  });
});
</script>

  {% endblock %}
